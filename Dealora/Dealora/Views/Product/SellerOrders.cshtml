@model IEnumerable<Dealora.Models.ViewModel.OrderDeatilsViewModel>

@{
    ViewBag.Title = "Seller Orders";
}

<script>
    setTimeout(() => {
        const box = document.getElementById('hide');
        box.style.display = 'none';
    }, 5000)
</script>

<h2>Order Information</h2>
<hr />

@if (TempData["msgUpdate"] != null)
{
    <div id="hide" class="alert alert-success">
        <strong>Success: </strong> @TempData["msgUpdate"]
    </div>
}

<table class="table table-hover table-bordered" id="OrderTable">
    <thead class="table-info">
        <tr>
            <th scope="col">Customer Name</th>
            <th scope="col">Order Items</th>
            <th scope="col">Order Date</th>
            <th scope="col">Total Amount</th>
            <th scope="col">Address</th>
            <th scope="col">Status</th>

        </tr>
    </thead>
    <tbody>
        @foreach (var orderDetail in Model)
        {
            <tr class="table-secondary">
                <td>@Html.DisplayFor(modelItem => orderDetail.Order.User.FirstName) @Html.DisplayFor(modelItem => orderDetail.Order.User.LastName)</td>
                <td>
                    <ul>
                        @foreach (var item in orderDetail.OrderItems)
                        {
                            <li>
                                Product: @Html.DisplayFor(modelItem => item.Product.Name) -
                                Quantity: @Html.DisplayFor(modelItem => item.Quantity) -
                                Price: @Html.DisplayFor(modelItem => item.PriceAtPurchase)
                            </li>
                        }
                    </ul>
                </td>
                <td>@Html.DisplayFor(modelItem => orderDetail.Order.OrderDate)</td>
                <td>@Html.DisplayFor(modelItem => orderDetail.Order.TotalAmount)</td>
                <td>@Html.DisplayFor(modelItem => orderDetail.Order.Address.StreetAddress), @Html.DisplayFor(modelItem => orderDetail.Order.Address.City)</td>
                <td>
                    <form asp-action="UpdateOrderStatus" method="post">
                        <input type="hidden" name="orderId" value="@orderDetail.Order.Id" />
                        <select name="status" class="form-control">
                            @foreach (var status in Enum.GetValues(typeof(Dealora.Models.OrderStatus)))
                            {
                                <option value="@status" @(status.Equals(orderDetail.Order.Status) ? "selected" : "")>@status</option>
                            }
                        </select>
                        <br />
                        <button type="submit" class="btn btn-primary btn-sm">Update</button>
                    </form>
                </td>
            </tr>
        }
    </tbody>
</table>

@section scripts {
    <!-- jQuery and DataTables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.5/css/jquery.dataTables.min.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.8.1/font/bootstrap-icons.min.css">

    <script>
        $(document).ready(function () {
            // Initialize DataTable
            $('#OrderTable').DataTable({
                "dom": '<"top"f>t<"bottom"p><"clear">',
                "language": {
                    "search": "",
                    "searchPlaceholder": "Type to search..."
                }
            });

            // Style the search box
            $('#OrderTable_filter input')
                .addClass('form-control')
                .attr('placeholder', 'Search orders...')
                .css({
                    'width': '300px',
                    'display': 'inline-block',
                    'margin-left': '10px'
                });

            // Adjust the table wrapper
            $('#OrderTable_wrapper .top').css({
                'display': 'flex',
                'justify-content': 'flex-end',
                'margin-bottom': '10px'
            });
        });
    </script>
}
